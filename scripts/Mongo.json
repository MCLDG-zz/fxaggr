db.pricestats.drop()
db.PriceColl.aggregate(
    [{
        $group: {
            _id: {
                symbol: "$symbol",
                hour: "$datetime.time.hour"
            },
            totalAsk: {
                $sum: {
                    $multiply: ["$bid", "$ask"]
                }
            },
            averageAsk: {
                $avg: "$ask"
            },
            averageBid: {
                $avg: "$bid"
            },
            averageSpread: {
                $avg: {
                    $subtract: ["$ask", "$bid"]
                }
            },
            maxSpread: {
                $max: {
                    $subtract: ["$ask", "$bid"]
                }
            },
            minSpread: {
                $min: {
                    $subtract: ["$ask", "$bid"]
                }
            },
            count: {
                $sum: 1
            }
        }
    }, {
        $out: "pricestats"
    }]
)

db.aggrconfig.drop()
db.aggrconfig.insert({
    "symbol": "AUDCAD",
    "pctLeewayAllowedSpread": 10.0,
    "pctLeewayToPreviousBid": 10.0,
    "pctLeewayToPreviousAsk": 5.5,
    "pctAboveMaxSpread": 5.0,
    "pctBelowMinSpread": 2.0
})
db.aggrconfig.insert({
    "symbol": "USDEUR",
    "pctLeewayAllowedSpread": 10.0,
    "pctLeewayToPreviousBid": 10.0,
    "pctLeewayToPreviousAsk": 5.5,
    "pctAboveMaxSpread": 5.0,
    "pctBelowMinSpread": 2.0
})

db.priceoutliers.drop()
